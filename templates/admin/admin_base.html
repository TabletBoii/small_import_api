<!DOCTYPE html>
<html lang="ru">
    <head>
      <meta charset="UTF-8">
      <title>{% block title %}–ú–æ–π —Å–∞–π—Ç{% endblock %}</title>
      <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

      <base href="{{ request.base_url }}">

      <link
        rel="stylesheet"
        href="{{ url_for('static', path='admin_panel.css') }}"
      />
      <script src="https://kit.fontawesome.com/74b9f45d18.js" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"/>
      <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
      <script src="/static/js/custom_toast.js"></script>
      <script src="/static/js/modalWindow.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.19.0/dist/powerbi.js"></script>
    </head>

    <body>
      <div class="container">
        <aside class="sidebar" id="sidebar">
          <div class="logo"><span>Admin</span></div>
          <nav>
            <a href="/admin/"><i class="icon">üè†</i><span class="label">–î–∞—à–±–æ—Ä–¥</span></a>
            <a href="/admin/users"><i class="icon">üë•</i><span class="label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></a>
            <a href="/admin/resources"><i class="icon">üìä</i><span class="label">–†–µ—Å—É—Ä—Å—ã</span></a>
            <a href="/admin/pbi_resource">{% include "powerbi.svg"%}<span class="label">–†–µ—Å—É—Ä—Å—ã PowerBI</span></a>
            <a href="/admin/resource_type"><i class="icon">üóÇÔ∏è</i><span class="label">–¢–∏–ø—ã —Ä–µ—Å—É—Ä—Å–æ–≤</span></a>
            <a href="/admin/access"><i class="icon">üîë</i><span class="label">–î–æ—Å—Ç—É–ø—ã</span></a>

            <a href="/admin/access_request"><i class="icon">üõÇ</i><span class="label">–ó–∞–ø—Ä–æ—Å—ã –¥–æ—Å—Ç—É–ø–∞</span><span id="pending-count-badge" class="badge" style="display:none;">0</span></a>
            <a href="/admin/logout"><i class="icon">üö™</i><span class="label">–í—ã—Ö–æ–¥</span></a>
          </nav>
        </aside>
        <div class="main">
          <header class="header">
            <button id="sidebarToggle">‚ò∞</button>
            <h1>Dashboard</h1>
            <input class="search" type="text" placeholder="Search...">
          </header>

          <div class="content">
            {% block admin_content %}{% endblock %}
          </div>
          <script>
            const toggleBtn = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            toggleBtn.addEventListener('click', () => {
              sidebar.classList.toggle('collapsed');
            });
            async function updatePendingCount() {
              try {
                const res = await fetch("/admin/pending_access_request_count");
                const data = await res.json();
                const badge = document.getElementById("pending-count-badge");

                if (data.count > 0) {
                  badge.textContent = data.count;
                  badge.style.display = "inline-block";
                } else {
                  badge.style.display = "none";
                }
              } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ pending_count:", e);
              }
            }

            updatePendingCount();
            setInterval(updatePendingCount, 10000);
          </script>
        </div>
      </div>
    </body>
</html>