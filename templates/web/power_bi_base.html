{% extends "base.html" %}
{% block title %}Embedded PowerBI Report{% endblock %}
{% block content %}
  <div id="reportContainer" style="height:90vh"></div>
{% endblock %}
{% block scripts %}
  <script>
    async function loadReport() {
      const routeParam = '{{ data }}';
      const resp = await fetch(`/web/power_bi_base/embed-params/${routeParam}`);
      const { embedUrl, embedToken } = await resp.json();
      const pbiClient = window['powerbi-client'];
      const models = pbiClient.models;
      const config = {
        type: 'report',
        tokenType: models.TokenType.Embed,
        accessToken: embedToken,
        embedUrl: embedUrl,
        settings: { panes: { filters: { visible: false } } }
      };
      window.powerbi.embed(
        document.getElementById('reportContainer'),
        config
      );
    }
    loadReport().catch(console.error);
  </script>
{% endblock %}